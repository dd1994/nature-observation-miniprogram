<view class="page-container">
  <t-swiper current="{{currentPhoto}}" autoplay="{{true}}" duration="{{500}}" interval="{{3000}}" loop="{{true}}" list="{{swiperList}}" height="{{'750rpx'}}" navigation="{{ { type: 'dots-bar' } }}" t-class="swiper-theme" bind:click="onSwiperClick" />
  <taxon-cell taxon="{{taxonInfo}}"></taxon-cell>
  <t-divider t-class="custom-divider" />
  <t-tabs swipeable="{{false}}" split="{{false}}" defaultValue="{{1}}" t-class="custom-tabs" t-class-track="custom-track">
    <t-tab-panel label="信息" value="0" icon="info-circle">
      <view class="observation-user-info">
        <view class="observation-user-info__title">
          <t-icon size="44rpx" name="user-1" style="margin-right: 8rpx;" />
          <view>观察者</view>
        </view>
        <view class="observation-user-info__detail">
          <user-name-and-avatar userProfile="{{observationDetail}}"></user-name-and-avatar>
          <view class="observation-on-time">
            观察于<text style="margin-left: 8rpx;">{{formattedObservedOn}}</text>
          </view>
        </view>
      </view>
      <view wx:if="{{description}}" class="observation-desc">
        <view class="observation-desc__title">
          <t-icon name="edit-1" style="margin-right: 8rpx"></t-icon>
          <view>观察备注</view>
        </view>
        <text selectable>{{description}}</text>
      </view>
      <t-cell bordered="{{false}}" wx:if="{{recommend_address_name && !observationDetail.address_hidden}}" hover arrow bind:click="openMap">
        <view slot="title" style="display: flex; align-items: center;">
          <t-icon size="44rpx" name="location" style="margin-right: 8rpx;" /> 观察位置
        </view>
        <view class="observation-location-name" slot="description">
          {{recommend_address_name}}
        </view>
      </t-cell>

      <t-cell bordered="{{false}}" wx:if="{{recommend_address_name && observationDetail.address_hidden}}">
        <view slot="title" style="display: flex; align-items: center;">
          <t-icon size="44rpx" name="location" style="margin-right: 8rpx;" /> 观察位置
        </view>
        <view class="observation-location-name" slot="description">
          {{recommend_address_name}}
        </view>
      </t-cell>

      <view class="custom-field-config-wrapper" wx:if="{{customFieldConfig.length}}">
        <view class="custom-field-config-title">
          <t-icon size="44rpx" name="task-1" style="margin-right: 8rpx;" />
          <view>更多物种信息</view>
          <view wx:if="{{notEmptyCustomFieldValue.length}}" class="custom-field-config-view-history-btn" hover-class="common-hover-class" bind:tap="viewCustomFieldValueHistory">查看历史</view>
        </view>
        <custom-field showRemoveIcon="{{isOwner}}" custom-field-config="{{customFieldConfig}}" custom-field-value="{{customFieldValue}}" bind:customFieldValueChange="customFieldValueChange" />
      </view>

      <view wx:if="{{isOwner}}" class="edit-button-wrapper">
        <t-button bind:tap="edit" icon="edit" theme="primary" block size="medium" variant="outline">编辑记录</t-button>
      </view>
    </t-tab-panel>
    <t-tab-panel label="鉴定" value="1" icon="lightbulb">
      <view class="identifications-pannel">
        <identifications identifications="{{identifications}}" userProfile="{{userProfile}}" bind:agreeID="agreeID" />
        <view class="edit-button-wrapper">
          <t-button icon="filter-2" theme="primary" block size="medium" bind:tap="addIdentification">
            {{isOwner ? '改进鉴定' : '帮忙鉴定'}}
          </t-button>
        </view>
      </view>
    </t-tab-panel>
  </t-tabs>
  <t-dialog visible="{{showCustomFieldValueHistory}}" title="信息添加历史" confirm-btn="知道了" bind:confirm="closeCustomFieldValueHistoryDialog">
    <!-- 适配skyline，增加type="list" -->
    <scroll-view slot="content" type="list" scroll-y class="cutom-config-value-history-content">
      <view class="cutom-config-value-history-content__item" wx:for="{{customFieldValueHistory}}" key="id">
        <view class="cutom-config-value-history-content__item__main {{item.status === 0 ? 'cutom-config-value-history-content__item__main--deleted' : ''}}">
          <view>{{item.customFieldConfigName}}：</view>
          <view wx:if="{{item.customFieldConfigType === 'select'}}">{{item.value}}</view>
          <view wx:if="{{item.customFieldConfigType === 'taxon'}}">{{item.extra.taxon.preferred_common_name}}</view>
        </view>
        <view class="cutom-config-value-history-content__item__user">{{item.user_name}}添加于{{item.updated_at}}</view>
      </view>
    </scroll-view>
  </t-dialog>
  <t-fab icon="share-1" button-props="{{fabButton}}" aria-label="分享" style="bottom: 128rpx"></t-fab>
  <t-button wx:if="{{backIconTop}}" bind:tap="back" style="{{backIconStyle}}" t-class="back-icon" size="small" variant="outline" ghost icon="arrow-left" shape="circle" aria-label="搜索">

  </t-button>
</view>